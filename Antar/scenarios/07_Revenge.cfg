#textdomain wesnoth-Antar

#define INITIALIZE_SCENARIO_VARIABLES
	{VARIABLE message_already_spoken 0}
	{VARIABLE fire_started no}
	{VARIABLE firespread_2_done 0}
	{VARIABLE orc_burned 0}
	{VARIABLE wose_burned 0}
	{VARIABLE troll_support 0}
	{VARIABLE troll_support_message 0}
	{VARIABLE wose_create 0}
	{VARIABLE count_till_message 0}
#enddef

#define CLEAR_SCENARIO_VARIABLES
	{CLEAR_VARIABLE message_already_spoken}
	{CLEAR_VARIABLE starts_burning}
	{CLEAR_VARIABLE new_fire_hex}
	{CLEAR_VARIABLE already_burned}                ###pillager firestart 1 to prevent the fire spreads to fast
	{CLEAR_VARIABLE fire_started}                  ###firespread
	{CLEAR_VARIABLE firespread_2_done}             ###firespread
	{CLEAR_VARIABLE old_fire}                      ###fire animated to fire unanimated
	{CLEAR_VARIABLE firedead}                      ###fire_event firedead
	{CLEAR_VARIABLE orc_burned}                    ###burned orc message 1 2 3
	{CLEAR_VARIABLE wose_burned}                   ###burned wose message
	{CLEAR_VARIABLE troll_support}                 ###troll support what else
	{CLEAR_VARIABLE troll_support_message}         ###troll support what else
	{CLEAR_VARIABLE wose_create}                   ###count till wose appear
	{CLEAR_VARIABLE bagrokstore}                   ###troll support
	{CLEAR_VARIABLE orc_gold}                      ###end gold calculation
	{CLEAR_VARIABLE orc_gold_2}                    ###end gold calculation
	{CLEAR_VARIABLE count_till_message}            ###mesage wind fannded the fire...
	{CLEAR_VARIABLE revenge_wose}                  ###scroll to every wose whe they appear
#enddef

#define EAST_HALF
	x=40-48
	y=1-26
#enddef

#define UNSAVE_SIDE_OF_THE_RIVER
	x=7-48,9-48,13-48,14-48,15-48,16-48,17-48,18-48,19-48,20-48,23-48,24-48,25-48,26-48
	y=1-4,5,6,7-8,9,10-13,14,15,16,17-21,22,23-24,25,26
#enddef


### X_2 Y_2 move firestarter to next spot
### A_1 A_1 start fire there

#define FIRESTART ID A_X1 A_Y1 X_2 Y_2
	[animate_unit]
		[filter]
			id={ID}
		[/filter]
		flag=attack
		hits=yes
		[primary_attack]
			name=torch
		[/primary_attack]
		[facing]
			[filter]
				x,y={A_X1},{A_Y1}
			[/filter]
		[/facing]
	[/animate_unit]
	[terrain]
		x,y={A_X1},{A_Y1}
		terrain=Gd^Fy
	[/terrain]
	{LR_PHONO ambient/campfire.ogg}
	[redraw]                                                            ###needed
	[/redraw]
	{MOVE_UNIT (id={ID}) {X_2} {Y_2}}
	{FIRESPREAD_1}
#enddef

#define FIRESPREAD_1

	### transform random adjacent hexes to animated-fire-hexes

	[store_locations]
		variable=starts_burning
		terrain=Gs^Fms,Gs^Fp,Gs^Fdw,Gll^Fp,Hh^Fmw,Hh^Fp,Hh^Fdw,Ce
		[filter_adjacent_location]
			terrain=Gd^Fy
		[/filter_adjacent_location]
		[not]
			find_in=already_burned
		[/not]
	[/store_locations]
	{FOREACH starts_burning current_hex}
		{VARIABLE new_fire_hex 0}
		{RANDOM        0,1,1,2,3,3,4}
		[while]
			[variable]
				name=new_fire_hex
				less_than=$random
			[/variable]
			[do]
				[terrain]
					x=$starts_burning[$current_hex].x
					y=$starts_burning[$current_hex].y
					terrain=Gd^Fy
				[/terrain]
				{LR_PHONO ambient/campfire.ogg}
				{VARIABLE_OP new_fire_hex add 1}
				[if]														### check if is a unit on the hex
					[have_unit]
						x=$starts_burning[$current_hex].x
						y=$starts_burning[$current_hex].y
					[/have_unit]
					[then]
						[store_unit]
							[filter]
								x=$starts_burning[$current_hex].x
								y=$starts_burning[$current_hex].y
							[/filter]
							variable=firedead
							kill=no
						[/store_unit]
						[redraw]
						[/redraw]
###						{DEBUG_MSG "Units id is $firedead.id"}
						[fire_event]
							name=firedead
						[/fire_event]
						[redraw]
						[/redraw]
					[/then]
				[/if]
			[/do]
		[/while]
		[store_locations]
			variable=already_burned
			terrain=Gs^Fms,Gs^Fp,Gs^Fdw,Gll^Fp,Hh^Fmw,Hh^Fp,Hh^Fdw,Ce
			[filter_adjacent_location]
				terrain=Gd^Fy
			[/filter_adjacent_location]
		[/store_locations]
		{CLEAR_VARIABLE new_fire_hex}
		{CLEAR_VARIABLE RANDOM}
		{NEXT current_hex}
#enddef

#define FIRESPREAD_2
				### transform all animated-fire-hexes in non-animated-hexes

		[if]
			[variable]
				name=firespread_2_done
				less_than=3
			[/variable]
			[then]
				[store_locations]
					variable=old_fire
					terrain=Gd^Fy
				[/store_locations]
				{FOREACH old_fire current_hex}
					[terrain]
						x=$old_fire[$current_hex].x
						y=$old_fire[$current_hex].y
						terrain=Gd^Fyyy
					[/terrain]
				{NEXT current_hex}
				{VARIABLE_OP firespread_2_done add 1}
			[/then]

			[else]
				[store_locations]
					variable=old_fire
					terrain=Gd^Fyyy
					[not]
						[filter_adjacent_location]
							terrain=Gs^Fms,Gs^Fp,Gs^Fdw,Gll^Fp,Hh^Fmw,Hh^Fp,Hh^Fdw,Hhd^Fdw,Ce^Fp,Ke^Fp,Ce
						[/filter_adjacent_location]
					[/not]
				[/store_locations]
				{FOREACH old_fire current_hex}
					[terrain]
						x=$old_fire[$current_hex].x
						y=$old_fire[$current_hex].y
						terrain=Gd^Fyy
					[/terrain]
				{NEXT current_hex}
			[/else]
		[/if]

		### transform random adjacent hexes to animated-fire-hexes

		[store_locations]
			variable=starts_burning
			terrain=Gs^Fms,Gs^Fp,Gs^Fdw,Gll^Fp,Hh^Fmw,Hh^Fp,Hh^Fdw,Hhd^Fdw,Ce^Fp,Ke^Fp,Ce
			[filter_adjacent_location]
				terrain=Gd^Fyyy
			[/filter_adjacent_location]
		[/store_locations]
		{VARIABLE_OP wose_create add 1}
		[if]
			[variable]
				name=wose_create
				numerical_equals=4
			[/variable]
			[then]
				{RANDOM "0..$($starts_burning.length - 1)"}

				{LR_GENERIC_GUARD_UNIT 3 (Elder Wose) $starts_burning[$random].x $starts_burning[$random].y}
			[/then]
		[/if]
		{FOREACH starts_burning current_hex}
			{VARIABLE new_fire_hex 0}
			{RANDOM        0,0,1,1,1,2}
			[while]
				[variable]
					name=new_fire_hex
					less_than=$random
				[/variable]
				[do]
					[terrain]
						x=$starts_burning[$current_hex].x
						y=$starts_burning[$current_hex].y
						terrain=Gd^Fyyy
					[/terrain]
					{LR_PHONO ambient/campfire.ogg}
					{VARIABLE_OP new_fire_hex add 1}
					[if]														### check if is a unit on the hex
						[have_unit]
							x=$starts_burning[$current_hex].x
							y=$starts_burning[$current_hex].y
						[/have_unit]
						[then]
							[store_unit]
								[filter]
									x=$starts_burning[$current_hex].x
									y=$starts_burning[$current_hex].y
								[/filter]
								variable=firedead
								kill=no
							[/store_unit]
							[redraw]
							[/redraw]
							[fire_event]
								name=firedead
							[/fire_event]
							[redraw]
							[/redraw]
						[/then]
					[/if]
				[/do]
			[/while]
			{CLEAR_VARIABLE new_fire_hex}
			{CLEAR_VARIABLE RANDOM}
		{NEXT current_hex}
		{VARIABLE_OP count_till_message add 1}
#enddef










[scenario]
	id="Revenge"
	name= _ "Revenge"
	map_data="{~add-ons/Antar/maps/07_Revenge.map}"
	{TURNS 28 24 22}
	victory_when_enemies_defeated=yes

	{DEFAULT_SCHEDULE}

	next_scenario="The_Dwarves"

	{MOOD_MAINTHEME}

	[side]
		type=Elvish Marshal
		id=Elorial Din
		name= _ "Elorial Din"
		side=1
		color=green
		team_name=Antar
		user_team_name=_ "Elves"
		canrecruit=yes
		controller=human
		recruit= Elvish Archer, Elvish Fighter, Elvish Scout, Elvish Shaman, Elvish Hunter
		gold=200
		{FLAG_VARIANT wood-elvish}
	[/side]


	[side]
		type=Orcish Sovereign
		id="Hag`ta`morg"
		name= _ "Hag`ta`morg"
		profile="portraits/orcs/sovereign.png"
#		profile=portraits/Hagtamorg.png
		side=2
		color=brown
		team_name=Orcs
		user_team_name=_"Orcs"
		canrecruit=yes
		recruit=Goblin Spearman, Goblin Impaler
		[ai]
			recruitment_ignore_bad_combat=yes
			recruitment_ignore_bad_movement=yes
			aggression=1.0
			caution=0.0
			grouping=no
			passive_leader=yes
			protect_leader=2.0
			protect_leader_radius=10
			[target]
				side=1
				value=5
			[/target]
			[target]
				side=3
				value=1
			[/target]
			[protect_location]
				x,y=23,25
				radius=8
				value=10
			[/protect_location]
			[avoid]
				x=28-48
				y=1-26
			[/avoid]
		[/ai]
		{GOLD 230 250 270}
		{INCOME 12 17 22}
		{FLAG_VARIANT ragged}
	[/side]

	{STARTING_VILLAGES 2 25}

	[side]
		side=3
		color=orange
		no_leader=yes
		user_team_name= _ "Wose"
		team_name=Wose
		canrecruit=no
		[ai]
			[target]
				[filter]
					id="Hag`ta`morg"
				[/filter]
			[/target]
			villages_per_scout=0
		[/ai]
		hidden=yes
		gold=0
	[/side]


	{LR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (2)          "Orcish Warrior"       1 2 3}
	{LR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (2)          "Orcish Crossbowman"   1 1 2}
	{LR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (2)          "Orcish Assassin"      2 3 3}
	{LR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (2)          "Orcish Grunt"         5 6 7}
	{LR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (2)          "Orcish Archer"        3 4 5}
	{LR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (2)          "Wolf Rider"           1 1 1}
	{LR_LIMIT_CONTEMPORANEOUS_RECRUITS_DIFFICULTY_DEPENDANT (2)          "Goblin Impaler"       2 2 2}



	{STORY_REVENGE}










	[event]
		name=prestart

		{LR_GENERIC_NAMED_GUARD_UNIT 2 "Orcish Crossbowman"   18  9 (Lugro)   }
		{LR_GENERIC_NAMED_GUARD_UNIT 2 "Orcish Slurbow"       18 12 (Blorsmer)}
		{GENERIC_UNIT 2 "Orcish Warrior"     21 21} {GUARDIAN}
		{GENERIC_UNIT 2 "Orcish Crossbowman" 17 17} {GUARDIAN}
		{GENERIC_UNIT 2 "Orcish Grunt"       15 12} {GUARDIAN}
		{GENERIC_UNIT 2 "Orcish Grunt"       24 25} {GUARDIAN}
		{GENERIC_UNIT 2 "Orcish Archer"      23 25} {GUARDIAN}
#ifdef HARD
		{GENERIC_UNIT 2 "Orcish Archer"      24 26} {GUARDIAN}
#endif

		{CHECK ELORIALS LOYALS 1}


		{MODIFY_UNIT (id="Elorial Din") facing sw}
		{MODIFY_UNIT (id=Bridal)        facing sw}
		{MODIFY_UNIT (id=Emirond)       facing sw}
		{MODIFY_UNIT (id=Nopirmd)       facing sw}

		[objectives]
			side=1
			[objective]
				condition=win
				description=_ "Defeat the enemy leader"
			[/objective]
			[objective]
				condition=lose
				description=_ "Death of Elorial Din"
			[/objective]
			[objective]
				condition=lose
				description=_ "Turns run out"
			[/objective]

			note={EARLY_FINISH_BONUS_NOTE}+{NEW_GOLD_CARRYOVER_NOTE_40}
		[/objectives]

		{INITIALIZE_SCENARIO_VARIABLES}
	[/event]










		###################
		###### start ######
		###################



	[event]
		name=start

		[redraw]
		[/redraw]
		[delay]
			time=500
		[/delay]
		[message]
			speaker="Elorial Din"
			message= _ "There they are..."
			image="portraits/Elorial Din_R.png~RIGHT()"
		[/message]
		[scroll_to]
			x,y=13,11
		[/scroll_to]
		[delay]
			time=1000
		[/delay]
		[message]
			speaker="Elorial Din"
			message= _ "Let’s bring the war back to the Orks.

<b>ATTACK!</b>"
			image="portraits/Elorial Din_R.png~RIGHT()"
		[/message]
	[/event]


		#########################
		### firestarter event ###
		#########################

	[event]
		name=turn end
		first_time_only=no

		[if]
			[variable]
				name=fire_started
				equals=no
			[/variable]
			[then]
				[if]
					[have_unit]
						side=1
						{EAST_HALF}
					[/have_unit]
					[then]
					[/then]
					[else]
						[fire_event]
							name=start_fire
						[/fire_event]
					[/else]
				[/if]
			[/then]
		[/if]
	[/event]

	### alternativ firestart when it is on turn 6 not yet triggered

	[event]
		name=turn 6 end

		[if]
			[variable]
				name=fire_started
				equals=no
			[/variable]
			[then]
				[fire_event]
					name=start_fire
				[/fire_event]
			[/then]
		[/if]
	[/event]

	[event]
		name=start_fire

		[message]
			speaker="Hag`ta`morg"
			message= _ "<b>NOW!</b>"
		[/message]

		#Pillager 1  Firestarter
		[scroll_to]
			x,y=45,10
		[/scroll_to]
		[delay]
			time=200
		[/delay]
		[move_unit_fake]
			type=Goblin Pillager
			x=47,46,45
			y=12,11,10
			side=1
		[/move_unit_fake]
		[unit]
			type=Goblin Pillager
				[modifications]
					{TRAIT_QUICK}
				[/modifications]
			id="Ko`darr"
			name="Ko`darr"
			side=2
			x,y=45,10
			facing=sw
		[/unit]
		[delay]
			time=400
		[/delay]
		[move_unit_fake]
			type=Goblin Pillager
			x=47,46,45
			y=13,12,11
			side=1
		[/move_unit_fake]
		[unit]
			type=Goblin Pillager
				[modifications]
					{TRAIT_QUICK}
				[/modifications]
			id="Rag`dor"
			name="Rag`dor"
			side=2
			x,y=45,11
			facing=sw
		[/unit]
		[message]
			speaker="Ko`darr"
			message= _ "Ready Chief, Har har!"
		[/message]
		{MOVE_UNIT (id=Ko`darr)          44  6}
		{FIRESTART (Ko`darr)    43  7    (44,42)  (5,3)}
		{FIRESTART (Ko`darr)    41  4    37  2}
		{FIRESTART (Ko`darr)    36  2    32  1}
		{FIRESTART (Ko`darr)    31  2    27  1}
		{FIRESTART (Ko`darr)    26  1    22  1}
		{FIRESTART (Ko`darr)    21  2    17  1}
		{FIRESTART (Ko`darr)    16  1    (17,12)  (3,7)}
		[kill]
			id="Ko`darr"
			animate=no
		[/kill]
		[unit]
			type=Goblin Knight
				[modifications]
					{TRAIT_QUICK}
				[/modifications]
			id="Ko`darr"
			name="Ko`darr"
			side=2
			x,y=12,7
			facing=ne
		[/unit]







		#Pillager 2  Firestarter
		[scroll_to]
			x,y=44,11
		[/scroll_to]
		[delay]
			time=200
		[/delay]
		{MOVE_UNIT (id=Rag`dor)          44 11}
		{FIRESTART (Rag`dor)    43 12    44 16}
		{FIRESTART (Rag`dor)    43 17    44 21}
		{FIRESTART (Rag`dor)    43 22    41 24}
		{FIRESTART (Rag`dor)    40 24    37 26}
		{FIRESTART (Rag`dor)    36 25    20 19}
		{MODIFY_UNIT (id=Rag`dor)    facing se}
		[message]
			speaker="Rag`dor"
			message= _ "Ha Ha Ha!"
		[/message]
		[message]
			speaker="Rag`dor"
			message= _ "Burn trees, burn Elves!
			
<b>Burn</b> Ha Ha Ha!"
		[/message]
		[kill]
			id="Rag`dor"
			animate=no
		[/kill]
		[unit]
			type=Goblin Knight
				[modifications]
					{TRAIT_QUICK}
				[/modifications]
			id="Rag`dor"
			name="Rag`dor"
			side=2
			x,y=20,19
		[/unit]
		[unit]
			type=Orcish Grunt
			id="Kalldal"
			name="Kalldal"
			side=2
			x,y=10,12
			profile="portraits/orcs/grunt-3.png"
			ai_special=guardian
		[/unit]
		[message]
			speaker="Elorial Din"
			message= _ "<span size='xx-large' weight='heavy'>A trap! This is a trap! </span>"
			image="portraits/Elorial Din_R.png~RIGHT()"
		[/message]
		[message]
			speaker="Kalldal"
			message= _ "Hey chief, the elves are trapped like mice!"
		[/message]
		[message]
			speaker="Hag`ta`morg"
			message= _ "Yes Mouse trapped! Hahaha!"
		[/message]

		[objectives]
			side=1
			[objective]
				condition=win
				description=_ "Survive and "
			[/objective]
			[objective]
				condition=win
				description=_ "Defeat the enemy leader"
			[/objective]
			[objective]
				condition=lose
				description=_ "Death of Elorial Din"
			[/objective]
			[objective]
				condition=lose
				description=_ "Turns run out"
			[/objective]

			note={EARLY_FINISH_BONUS_NOTE}+{NEW_GOLD_CARRYOVER_NOTE_40}
		[/objectives]

		{VARIABLE_OP fire_started value yes}
	[/event]


		###################
		### fire spread ###
		###################

	[event]
		name=turn end
		first_time_only=no

		[if]
			[variable]
				name=fire_started
				equals=yes
			[/variable]
			[then]
				{FIRESPREAD_2}
			[/then]
		[/if]
	[/event]


		#################################
		### check what side is burned ###
		#################################

	[event]
		name=firedead
		first_time_only=no

		### elvish fire victim

		[if]
			[variable]
				name=firedead.side
				equals=1
			[/variable]
			[then]
				[scroll_to]
					x=$firedead.x
					y=$firedead.y
				[/scroll_to]
				[message]
					speaker=$firedead.id
					message=_ "Ayyyyee"
				[/message]
				[kill]
					id=$firedead.id
					animate=yes
				[/kill]
				[message]
					speaker="Elorial Din"
					message=_ "No, $firedead.name is burned to death. Keep away from the fire!"
				[/message]
				{CLEAR_VARIABLE firedead}
			[/then]
		[/if]

		### orcish fire victim

		[if]
			[variable]
				name=firedead.side
				equals=2
			[/variable]
			[then]
				[scroll_to]
					x=$firedead.x
					y=$firedead.y
				[/scroll_to]
				{RANDOM        (Ayyyyyeee,Ahhrg,Ayyeee,Nooooo,I burn,Ayyyeee)}
				[message]
					speaker=$firedead.id
					message=_ "$random"
				[/message]
				[kill]
					id=$firedead.id
					animate=yes
				[/kill]
				{VARIABLE_OP orc_burned add 1}
				[fire_event]
					name=orc_fire_victim
				[/fire_event]
				{CLEAR_VARIABLE random}
				{CLEAR_VARIABLE firedead}
			[/then]
		[/if]

		### wose fire victim

		[if]
			[variable]
				name=firedead.side
				equals=3
			[/variable]
			[then]
				[scroll_to]
					x=$firedead.x
					y=$firedead.y
				[/scroll_to]
				[message]
					speaker=$firedead.id
					message=_ "Ayyyyee"
				[/message]
				[kill]
					id=$firedead.id
					animate=yes
				[/kill]
				[fire_event]
					name=wose_fire_victim
				[/fire_event]
				{CLEAR_VARIABLE firedead}
			[/then]
		[/if]
	[/event]


		### fire event *orc*

	[event]
		name=orc_fire_victim
		first_time_only=no

		[if]
			[variable]
				name=orc_burned
				numerical_equals=1
			[/variable]
			[then]
				[message]
					speaker="Hag`ta`morg"
					message= _ "*<i>Angry</i>*  Stay away from the fire useless fool!"
				[/message]
			[/then]
		[/if]
		[if]
			[variable]
				name=orc_burned
				numerical_equals=2
			[/variable]
			[then]
				[message]
					speaker="Hag`ta`morg"
					message= _ "<b> I told you to stay away from the fire! </b> Why do they do not listen?"
				[/message]
			[/then]
		[/if]
		[if]
			[variable]
				name=orc_burned
				greater_than=2
			[/variable]
			[then]
				[message]
					speaker="Hag`ta`morg"
					message= _ "They are so stupid, so stupid!"
				[/message]
			[/then]
		[/if]
	[/event]


		### fire event *wose*

	[event]
		name=wose_fire_victim
		first_time_only=no

		[if]
			[variable]
				name=wose_burned
				numerical_equals=0
			[/variable]
			[then]
				{SCATTER_UNITS 1 "Ancient Wose" 0 (
					terrain=Gs^Fms,Gs^Fp,Gs^Fdw,Gll^Fp,Hh^Fmw,Hh^Fp,Hh^Fdw
					x=20-38
					y=7-20
					[not]
						[filter]
							[filter_adjacent_location]
								terrain=Gd^Fyyy,Gd^Fyy
								radius=2
							[/filter_adjacent_location]
						[/filter]
					[/not]
					[not]
						[filter]
							terrain=Gd^Fyyy,Gd^Fyy,Ce^Fp,Ke^Fp
							radius=2
						[/filter]
					[/not]
					[not]
						[filter]
						[/filter]
					[/not]
					[and]
						[not]
							[filter]
							[/filter]
						[/not]
					[/and]
					[and]
						[not]
							[filter]
								[filter_adjacent_location]
								[/filter_adjacent_location]
							[/filter]
						[/not]
					[/and]
				) (
					side=3
					random_traits=yes
				)}
				[redraw]
				[/redraw]
				[delay]
					time=100
				[/delay]
				[modify_side]
					side=3
					color=orange
					no_leader=yes
					user_team_name= _ "Wose"
					team_name=Antar
					canrecruit=no
					hidden=no
					gold=0
				[/modify_side]
				[redraw]
				[/redraw]
				[role]
					role=wose_speaker
					type=Ancient Wose,Elder Wose
					side=3
				[/role]
				[scroll_to_unit]
					[filter]
						role=wose_speaker
					[/filter]
				[/scroll_to_unit]
				[message]
					role=wose_speaker
					message= _ "They burnt $firedead.name down! We can not longer be passive."
					image=portraits/wose_speaker.png~RIGHT()
				[/message]
				{SCATTER_UNITS 7 "Wose,Elder Wose, Ancient Wose" 2 (
					terrain=Gs^Fms,Gs^Fp,Gs^Fdw,Gll^Fp,Hh^Fmw,Hh^Fp,Hh^Fdw
					x=20-38
					y=7-20
					[not]
						[filter]
							[filter_adjacent_location]
								terrain=Gd^Fyyy,Gd^Fyy
								radius=2
							[/filter_adjacent_location]
						[/filter]
					[/not]
					[not]
						[filter]
							terrain=Gd^Fyyy,Gd^Fyy
							radius=2
						[/filter]
					[/not]
					[not]
						[filter]
						[/filter]
					[/not]
					[and]
						[not]
							[filter]
							[/filter]
						[/not]
					[/and]
					[and]
						[not]
							[filter]
								[filter_adjacent_location]
								[/filter_adjacent_location]
							[/filter]
						[/not]
					[/and]
				) (
					side=3
					random_traits=yes
				)}
				[redraw]
				[/redraw]
				[message]
					speaker="Elorial Din"
					message= _ "WOSES! They join us!"
				[/message]
				[store_unit]
					variable=revenge_wose
					kill=no
					[filter]
						side=3
					[/filter]
				[/store_unit]
				{FOREACH revenge_wose i}
					[modify_unit]
						[filter]
							id=$revenge_wose[$i].id
						[/filter]
						goto_x=16
						goto_y=22
					[/modify_unit]
					[scroll_to]
						x=$revenge_wose[$i].x
						y=$revenge_wose[$i].y
					[/scroll_to]
					[delay]
						time=800
					[/delay]
				{NEXT i}
				{CLEAR_VARIABLE revenge_wose}
				[role]
					role=elf_speaker
					type=Elvish Shyde,Elvish Druid,Elvish Shaman,Elvish Sylph,Elvish Enchantress,Elvish Sorceress
					side=1
				[/role]
				[message]
					role=elf_speaker
					message= _ "I felt their presence since our arrival."
				[/message]
				[delay]
					time=1000
				[/delay]
				[message]
					role=wose_speaker
					message= _ "Lets smash those Orks!"
				[/message]
				{VARIABLE_OP wose_burned add 1}
			[/then]

			[else]
				[role]
					role=wose_speaker
					type=Ancient Wose,Elder Wose
					side=3
				[/role]
				[scroll_to_unit]
					[filter]
						role=wose_speaker
					[/filter]
				[/scroll_to_unit]
				{RANDOM         (They burnt $firedead.name down, $firedead.name goes down in flames, We lost our tree-brother $firedead.name, Oh no, $firedead.name, Oh no, $firedead.name is burnt to ashes)}
				[message]
					role=wose_speaker
					message= _ "$random!"
					image="portraits/woses/ancient-wose.png~RIGHT()"
				[/message]
				{CLEAR_VARIABLE random}
			[/else]
		[/if]
	[/event]


	[event]
		name=new turn
		first_time_only=no

		[if]
			[variable]
				name=count_till_message
				numerical_equals=2
			[/variable]
			[then]
				[message]
					speaker=narrator
					message=_ "Wind fanned the fire into a brisk blaze."
					image=wesnoth-icon.png
					{LR_PHONO ambient/campfire.ogg}
				[/message]

				{FIRESPREAD_2}

				[message]
					speaker="Elorial Din"
					message= _ "The fire is everywhere."

				[/message]
				[scroll_to]
					x,y=22,3
				[/scroll_to]
				[delay]
					time=500
				[/delay]
				[scroll_to]
					x,y=41,13
				[/scroll_to]
				[delay]
					time=500
				[/delay]
				[scroll_to]
					x,y=43,13
				[/scroll_to]
				[delay]
					time=500
				[/delay]
				[scroll_to]
					x,y=37,25
				[/scroll_to]
				[delay]
					time=500
				[/delay]
				[message]
					speaker="Elorial Din"
					message= _ "We must reach the other side of the river. Otherwise we are doomed to be scorched here."
				[/message]
				[scroll_to]
					x,y=13,22
				[/scroll_to]
				[delay]
					time=500
				[/delay]
				[scroll_to_unit]
					id="Elorial Din"
				[/scroll_to_unit]
			[/then]
		[/if]
	[/event]


		######################################################
		### change woses goal when they are over the river ###
		######################################################

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=3
			[not]
				{UNSAVE_SIDE_OF_THE_RIVER}
			[/not]
		[/filter]
		[modify_unit]
			[filter]
				x,y=$x1,$y1
			[/filter]
			goto_x=0
			goto_y=0
		[/modify_unit]
	[/event]


		############################################################
		### message elves are save on the west side of the river ###
		############################################################

	[event]
		name=moveto 
		first_time_only=no

		[if]
			[not]
				[have_unit]
					side=1,3
					{UNSAVE_SIDE_OF_THE_RIVER}
				[/have_unit]
			[/not]
			[and]
				[variable]
					name=message_already_spoken
					numerical_equals=0
				[/variable]
			[/and]
			[then]
				[message]
					speaker="Elorial Din"
					message= _ "Every Elf alive is on the other side of the river!"
				[/message]
				[message]
					speaker="Elorial Din"
					message= _ "Now to you, ork."
				[/message]
				{VARIABLE_OP message_already_spoken add 1}
			[/then]
		[/if]
	[/event]


		###########################################
		### message elves invade the orc castle ###
		###########################################

	[event]
		name=moveto
		first_time_only=yes

		[filter]
			side=1
			[filter_location]
				x=10-11,10,  12,  13,13,  14,14,   15
				y=   11,12,9-11,9-11,16,9-13,16,10-13
			[/filter_location]
		[/filter]

		[if]
			[have_unit]
				side=2
				[not]
					canrecruit=yes
				[/not]
			[/have_unit]

			[then]
				[message]
					speaker="Hag`ta`morg"
					message= _ "They invade the stronghold!

Kill them finally!"
				[/message]
				[message]
					speaker=Elorial Din
					message= _ "You are the one who will die!"
				[/message]
			[/then]
			[else]
				[message]
					speaker="Hag`ta`morg"
					message= _ "They invade my stronghold!"
				[/message]
			[/else]
		[/if]
		[modify_side]
			side=2
			income=0
		[/modify_side]
	[/event]


		#####################
		### troll support ###
		#####################

	[event]
		name=turn 8

		[event]
			name=die
			first_time_only=no
			[filter]
				[not]
					side=1,3
				[/not]
			[/filter]
			[if]
				[have_unit]
					side=2
					count=19
				[/have_unit]
				[then]
					{VARIABLE_OP troll_support_message add 1}
				[/then]
			[/if]
			[if]
				[have_unit]
					side=2
					count=14
				[/have_unit]
				[then]
					{VARIABLE_OP troll_support add 1}
					{VARIABLE_OP troll_support_message add 2}
				[/then]
			[/if]
		[/event]
	[/event]

	[event]
		name=side 2 turn
		first_time_only=no
		[if]
			[variable]
				name=troll_support_message
				equals=1
			[/variable]
			[then]
				[message]
					speaker="Hag`ta`morg"
					message= _ "What became of the damn Ork I sent for reinforcements?"
				[/message]
				[message]
					speaker="Kalldal"
					message= _ "He should already be back!"
				[/message]
				[message]
					speaker="Hag`ta`morg"
					message= _ "He better hurry, or..."
				[/message]
				{VARIABLE_OP troll_support_message add 1}
			[/then]
		[/if]
	[/event]


	[event]
		name=side 2 turn
		first_time_only=no
		[if]
			[variable]
				name=troll_support
				equals=1
			[/variable]
			[then]
				{NAMED_UNIT 2 "Orcish Leader" 4  6  "Bagrok" "Bagrok" ()}
				{NAMED_UNIT 2 "Troll"         2  3  "Agru" "Agru"     ()}{GUARDIAN}
				{NAMED_UNIT 2 "Troll Whelp"   2  5  "Blen" "Blen"     ()}{GUARDIAN}
				{NAMED_UNIT 2 "Troll Whelp"   3  5  "Cerg" "Cerg"     ()}{GUARDIAN}
				{NAMED_UNIT 2 "Troll Whelp"   4  5  "Doo" "Doo"       ()}{GUARDIAN}
#				{NAMED_UNIT 2 "Troll Whelp"   5  7  "Edga" "Edga"     ()}{GUARDIAN}
#ifdef HARD
				{NAMED_UNIT 2 "Troll"         1  3  "Gampf" "Gampf"   ()}{GUARDIAN}
				{NAMED_UNIT 2 "Troll Whelp"   3  4  "Fagg" "Fagg"     ()}{GUARDIAN}
#endif
				{VARIABLE_OP troll_support add 1}
				[message]
					speaker="Bagrok"
					message= _ "Hey chief! I bring some trolls for reinforcement."
				[/message]
				[message]
					speaker="Hag`ta`morg"
					message= _ "Ah, Trolls, very good."
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		x,y=1-48,1-26
		[filter]
			id="Bagrok"
		[/filter]
		[store_unit]
			[filter]
				id="Bagrok"
			[/filter]
			mode=replace
			variable=bagrokstore
		[/store_unit]
		{MOVE_UNIT (id=Agru)  $bagrokstore.x, $bagrokstore.y}
		{MOVE_UNIT (id=Blen)  $bagrokstore.x, $bagrokstore.y}
		{MOVE_UNIT (id=Cerg)  $bagrokstore.x, $bagrokstore.y}
		{MOVE_UNIT (id=Doo)   $bagrokstore.x, $bagrokstore.y}
#		{MOVE_UNIT (id=Edga)  $bagrokstore.x, $bagrokstore.y}
#ifdef HARD
		{MOVE_UNIT (id=Gampf) $bagrokstore.x, $bagrokstore.y}
		{MOVE_UNIT (id=Fagg)  $bagrokstore.x, $bagrokstore.y}
#endif
	[/event]


		####################################################################
		### dont let the both orks be guardian on the burning river side ###
		####################################################################

	[event]
		name=turn 9

		{CLEAR_GUARDIAN (Lugro)}
	[/event]

	[event]
		name=turn 12

		{CLEAR_GUARDIAN (Blorsmer)}
	[/event]


		###################
		### last breath ###
		###################

	[event]
		name=last breath
		[filter]
			id="Hag`ta`morg"
		[/filter]
		[message]
			speaker="Hag`ta`morg"
			message= _ "No, don’t kill me.

Mal Kazur has promised so much to me. I would rule..."
		[/message]
		[message]
			speaker="Elorial Din"
			message= _ "And now tell us everything you know about Mal Kazur

Everything!"
		[/message]
		[message]
			speaker=second_unit
			message= _ "<b>Speak, scum!</b>"
		[/message]
		[message]
			speaker=narrator
			message=_ "The Orkish leader was talkative...
After a long and painful inquiry."
			image=wesnoth-icon.png
		[/message]
		[message]
			speaker=second_unit
			message= _ "<b>Die!</b>"
		[/message]
		[animate_unit]
			flag=attack
			with_bars=no
			[filter]
				id=second_unit
			[/filter]
			[primary_attack]
				range=melee
			[/primary_attack]
			hits=yes
			[animate]
				flag=defend
				[filter_second]
					id=unit
				[/filter_second]
				with_bars=no
				[primary_attack]
					range=melee
				[/primary_attack]
				[facing]
					[filter]
						id=second_unit
					[/filter]
				[/facing]
				hits=yes
			[/animate]
		[/animate_unit]
		[message]
			speaker="Hag`ta`morg"
			message= _ "Aaaaarrrgghghhh"
		[/message]
		[kill]
			id=unit
			animate=yes
		[/kill]
		[message]
			speaker=second_unit
			message= _ "The megalomaniacal Ork is dead."
		[/message]

		[if]
			[have_unit]
				side=2
			[/have_unit]
			[then]
				[kill]
					side=2
					animate=no
				[/kill]
				[message]
					speaker="Elorial Din"
					message= _ "The surviving Orks have fled to the hills."
				[/message]
			[/then]
			[else]
				[message]
					speaker="Elorial Din"
					message= _ "Every Ork here has been slain, we have left none alive."
				[/message]
			[/else]
		[/if]

		###some gold for the surviving elves

		[store_gold]
			side=1
			variable=orc_gold               ### is exprcted negativ elf-gold
		[/store_gold]
		[store_gold]
			side=1
			variable=orc_gold_2             ### is exprcted negativ elf-gold
		[/store_gold]
#		{DEBUG_MSG "Side 1 gold is $orc_gold"}
		{VARIABLE_OP orc_gold sub $orc_gold}
#		{DEBUG_MSG "Orc-Gold minus Orc-Gold is $orc_gold"}
		{VARIABLE_OP orc_gold sub $orc_gold_2}
#		{DEBUG_MSG "Orc-Gold minus Orc-Gold-2 is $orc_gold"}
#		[set_variable]
#			name=orc_gold
#			add=100
#			round=ceil
#		[/set_variable]
		{VARIABLE_OP orc_gold add 100}
		{VARIABLE_OP orc_gold round -2}
#		{DEBUG_MSG "Orc-Gold round -2 is $orc_gold"}
		[message]
			speaker=second_unit
			message= _ "This Ork has $orc_gold pieces of gold."
		[/message]
		[gold]
			side=1
			amount=$orc_gold
		[/gold]
		{LR_PHONO gold.ogg}
		[message]
			speaker="Elorial Din"
			message= _ "Hag`ta`morg is dead, and this will be a lesson for the Orks."
		[/message]
		[message]
			race=elf
			[not]
				canrecruit=yes
			[/not]
			message= _ "Yes, but that name again."
		[/message]
		[message]
			speaker="Elorial Din"
			message= _ "Mal Kazur again."
		[/message]
		[message]
			race=elf
			[not]
				canrecruit=yes
			[/not]
			message= _ "Before he died, he was talking about a special book."
		[/message]
		[message]
			speaker="Elorial Din"
			message= _ "Yes. Mal Kazur, or who ever hides behind this name seems to fear this book.
He has hidden it in a very secure place, and doesn’t want anybody to find it.
But we now know where it is.

And I am willing to get this book."
		[/message]

		[if]
			[have_unit]
				side=3
			[/have_unit]
			[then]
				[role]
					role=wose_survivor
					type=Ancient Wose,Elder Wose,Wose
					side=3
				[/role]
				[scroll_to_unit]
					[filter]
						role=wose_survivor
					[/filter]
				[/scroll_to_unit]
				[delay]
					time=400
				[/delay]
				[message]
					role=wose_survivor
					message= _ "Our habitat is burnt to ashes, we have decided to join you. We will take revenge on the ones who bear the blame for this."
				[/message]
				[message]
					speaker="Elorial Din"
					message= _ "Fight with us against Mal Kazur, or we all lose our homes, our freedom and our lives."
				[/message]
				{MODIFY_UNIT (side=3) side 1}
				[allow_recruit]
					type=Wose
					side=1
				[/allow_recruit]
				[message]
					speaker=narrator
					message=_ "Elorial din may now recruit Wose."
					image=wesnoth-icon.png
				[/message]
			[/then]
			[else]
				[message]
					speaker="Elorial Din"
					message= _ "It is sad that no Wose survived. Maybe they would have fought with us against Mal Kazur. Sad, they were strong creatures and die-hard fighters."
				[/message]
			[/else]
		[/if]

		[message]
			speaker="Elorial Din"
			message=_ "So let’s now search for the mysterious book."
		[/message]
		[endlevel]
			result=victory
			bonus=yes
			{NEW_GOLD_CARRYOVER 40}
		[/endlevel]
	[/event]

	[event]
		name=victory
		{CLEAR_SCENARIO_VARIABLES}
	[/event]

	{~add-ons/Antar/utils/utils.cfg}
	{~add-ons/Antar/utils/deaths.cfg}
[/scenario]


#undef FIRESTART ID A_X1 A_Y1 X_2 Y_2
#undef FIRESPREAD_1
#undef FIRESPREAD_2
#undef UNSAVE_SIDE_OF_THE_RIVER
#undef EAST_HALF
#undef INITIALIZE_SCENARIO_VARIABLES
#undef CLEAR_SCENARIO_VARIABLES
